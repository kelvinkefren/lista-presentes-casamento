<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kelvin & Tamaiale â€” 27/08/2025</title>
  <meta name="description" content="Site do casamento â€” fotos, presentes, PIX e confirmaÃ§Ã£o de presenÃ§a." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Great+Vibes&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    :root{
      --paper:#F5EEE9;            /* papel bege */
      --paper-2:#F2E7DF;          /* variaÃ§Ã£o */
      --ink:#2a2a2a;              /* texto */
      --muted:#6c6c6c;            /* texto fraco */
      --accent:#3C8C6F;           /* verde musgo */
      --accent-2:#C09D5C;         /* dourado */
      --chip:#fff;                /* chips claros */
      --edge:#d8cfc7;             /* borda sutil */
      --radius:18px;
      --shadow:0 10px 30px rgba(0,0,0,.12);
    }
    *{box-sizing:border-box}
    html,body{margin:0; color:var(--ink); font-family:"Cormorant Garamond", ui-serif, Georgia, serif; background:var(--paper);}
    /* textura de papel com manchas bem sutis */
    body:before{content:""; position:fixed; inset:0; pointer-events:none; opacity:.30; mix-blend-mode:multiply;
      background-image:
        radial-gradient(1000px 600px at -10% -5%, var(--paper-2), transparent 55%),
        radial-gradient(900px 600px at 110% 110%, var(--paper-2), transparent 55%),
        radial-gradient(2px 2px at 20% 40%, rgba(0,0,0,.06), transparent 55%),
        radial-gradient(2px 2px at 70% 60%, rgba(0,0,0,.05), transparent 55%),
        radial-gradient(3px 3px at 40% 85%, rgba(0,0,0,.04), transparent 55%),
        radial-gradient(3px 3px at 85% 25%, rgba(0,0,0,.04), transparent 55%);
      background-repeat:no-repeat;
    }

    /* NAV */
    .nav{position:sticky; top:0; z-index:20; background:color-mix(in oklab, var(--paper), white 30%);
      border-bottom:1px solid var(--edge);}
    .nav .inner{max-width:1200px; margin:0 auto; padding:14px 18px; display:flex; align-items:center; gap:20px;}
    .brand{font-weight:600; letter-spacing:.12em;}
    .brand small{font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color:var(--muted); letter-spacing:0;}
    .spacer{flex:1}
    .menu{display:flex; gap:18px; align-items:center; font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif}
    .menu a{color:inherit; text-decoration:none; padding:8px 10px; border-radius:999px}
    .menu a:hover{background:#fff; box-shadow:0 1px 0 rgba(0,0,0,.06);}

    /* HERO PAPEL RASGADO */
    .hero{position:relative; max-width:1200px; margin:24px auto 10px; padding:0 16px;}
    .torn-wrap{position:relative; border-radius:0; box-shadow:var(--shadow)}
    .torn{width:100%; height:auto; display:block}
    .hero-overlay{position:absolute; inset:auto 8% 10% 8%; text-align:center; color:white; text-shadow:0 1px 20px rgba(0,0,0,.35)}
    .hero-date{font-size:clamp(16px,2vw,20px); letter-spacing:.22em}
    .hero-names{font-family:"Great Vibes", cursive; font-weight:400; font-size:clamp(42px,5.6vw,74px); margin-top:10px}

    /* miolos */
    .wrap{max-width:1100px; margin:0 auto; padding:18px}
    .section{margin:28px 0}
    .title{font-weight:600; font-size:28px}
    .muted{color:var(--muted)}

    /* CartÃµes e botÃµes */
    .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:18px}
    .card{grid-column:span 12; border:1px solid var(--edge); background:#fff; border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden}
    .card .body{padding:18px}
    .btn{appearance:none; border:0; background:var(--accent); color:#fff; font-weight:600; padding:10px 14px; border-radius:999px; cursor:pointer}
    .btn.alt{background:#fff; color:var(--ink); border:1px solid var(--edge)}
    .btn.ghost{background:transparent; color:var(--ink); border:1px dashed var(--edge)}
    .toolbar{display:flex; flex-wrap:wrap; gap:10px}

    /* produtos */
    .controls{display:flex; flex-wrap:wrap; gap:10px; margin:10px 0 16px}
    .controls input, .controls select{background:#fff; border:1px solid var(--edge); padding:10px 12px; border-radius:12px; outline:none}
    .products{display:grid; grid-template-columns:repeat(3,1fr); gap:18px}
    @media(max-width:1000px){.products{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:640px){.products{grid-template-columns:1fr}}
    .product{background:#fff; border:1px solid var(--edge); border-radius:16px; overflow:hidden; display:flex; flex-direction:column}
    .product .img{aspect-ratio:4/3; background:#eee; display:grid; place-items:center}
    .product .img img{width:100%; height:100%; object-fit:cover; display:block}
    .product .content{padding:14px; display:flex; flex-direction:column; gap:8px}
    .product .price{font-weight:700}
    .product .actions{display:flex; gap:8px; flex-wrap:wrap; margin-top:auto}
    .badge{position:absolute; top:10px; left:10px; background:#fff; border:1px solid var(--edge); color:var(--ink); padding:6px 10px; border-radius:999px; font-size:12px}
    .tiny{font-size:12px; color:var(--muted)}

    footer{opacity:.9; margin:40px 0 80px; text-align:center}

    /* elementos decorativos (folhas) */
    .decor{position:fixed; z-index:0; opacity:.7; pointer-events:none}
    .decor.left{left:-60px; top:110px; width:220px}
    .decor.right{right:-40px; bottom:90px; width:240px}
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav">
    <div class="inner">
      <div class="brand">K + T <small>27 Â· 08 Â· 2025</small></div>
      <div class="spacer"></div>
      <nav class="menu">
        <a href="#presentes">Presentes</a>
        <a href="#rsvp">Confirmar PresenÃ§a</a>
        <a href="#pix">PIX</a>
      </nav>
    </div>
  </div>

  <!-- DECORAÃ‡Ã•ES (folhas em SVG, inline) -->
  <svg class="decor left" viewBox="0 0 120 220" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <defs>
      <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
        <stop offset="0" stop-color="#E9B27A"/>
        <stop offset="1" stop-color="#D77A57"/>
      </linearGradient>
    </defs>
    <g fill="url(#g1)" opacity=".7">
      <path d="M20 10c22 36-2 60-10 92-6 26 9 46 40 64-12-32-4-52 9-72 14-22 9-52-39-84z"/>
      <path d="M70 45c18 28-3 45-13 67-8 19 4 34 28 48-8-24-3-39 6-54 10-17 6-39-21-61z"/>
    </g>
  </svg>
  <svg class="decor right" viewBox="0 0 140 240" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <g fill="#E3B98C" opacity=".75">
      <path d="M80 15c28 30 14 60 7 86-7 27 7 50 35 76-10-34-6-56 5-78 12-24 0-55-47-84z"/>
      <path d="M30 70c20 22 8 40 2 57-5 17 4 33 22 49-9-22-6-37 1-50 8-15 3-36-25-56z"/>
    </g>
  </svg>

  <!-- HERO com mÃ¡scara "papel rasgado" -->
  <header class="hero" id="topo">
    <div class="torn-wrap">
      <!-- a mÃ¡scara Ã© um path irregular; a imagem vem do CONFIG.heroImage -->
      <svg class="torn" viewBox="0 0 1600 900" preserveAspectRatio="xMidYMid slice" aria-label="Foto do casal">
        <defs>
          <clipPath id="tornMask" clipPathUnits="objectBoundingBox">
            <!-- path aproximando um retÃ¢ngulo com bordas rasgadas -->
            <path d="M0.03,0.20 C0.10,0.18,0.18,0.22,0.25,0.20 C0.32,0.18,0.38,0.22,0.45,0.21 C0.52,0.20,0.60,0.22,0.66,0.20 C0.72,0.18,0.78,0.22,0.86,0.21 C0.93,0.20,0.97,0.22,1.00,0.24 L1.00,0.80 C0.96,0.82,0.92,0.78,0.86,0.79 C0.79,0.80,0.74,0.76,0.67,0.78 C0.60,0.80,0.54,0.76,0.47,0.78 C0.40,0.80,0.34,0.76,0.27,0.77 C0.20,0.78,0.13,0.75,0.08,0.77 C0.04,0.79,0.02,0.78,0.00,0.76 L0.00,0.26 C0.02,0.22,0.01,0.22,0.03,0.20 z" />
          </clipPath>
        </defs>
        <image id="heroImageEl" clip-path="url(#tornMask)" href="" width="1600" height="900" preserveAspectRatio="xMidYMid slice"/>
      </svg>
      <div class="hero-overlay">
        <div class="hero-date">27 Â· 08 Â· 2025</div>
        <div class="hero-names">Kelvin & Tamaiale</div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- PIX -->
    <section id="pix" class="section">
      <div class="grid">
        <div class="card">
          <div class="body">
            <div class="title">Contribuir via PIX</div>
            <p class="muted">Se preferir, vocÃª pode presentear com qualquer valor via Pix. ðŸ’š</p>
            <div class="toolbar">
              <span class="btn alt" id="pixKeyText">(configure a chave no cÃ³digo)</span>
              <button class="btn" id="copyPix">Copiar chave</button>
              <a class="btn ghost" id="openPixWhats" target="_blank" rel="noopener">Enviar comprovante (WhatsApp)</a>
            </div>
            <div style="margin-top:14px"><img id="pixQrImg" alt="QR Code Pix" style="max-width:320px;border-radius:12px;border:1px solid var(--edge)"/></div>
          </div>
        </div>
      </div>
    </section>

    <!-- PRESENTES -->
    <section id="presentes" class="section">
      <div class="title">Lista de Presentes</div>
      <p class="muted">Escolha um item, clique em <em>Reservar</em> para nos avisar no WhatsApp e depois <em>Comprar</em> no link da loja.</p>
      <div class="controls">
        <input id="q" type="search" placeholder="Buscar por nome, categoria..."/>
        <select id="cat"></select>
        <select id="sort">
          <option value="prioridade">Ordenar: prioridade</option>
          <option value="preco-asc">PreÃ§o: menor â†’ maior</option>
          <option value="preco-desc">PreÃ§o: maior â†’ menor</option>
          <option value="titulo">A-Z</option>
        </select>
        <label style="display:inline-flex;gap:8px;align-items:center"><input id="onlyAvail" type="checkbox"/> <span class="tiny">Apenas disponÃ­veis</span></label>
        <button class="btn alt" id="refresh">Atualizar</button>
      </div>
      <div id="products" class="products"></div>
      <div id="emptyState" class="muted" style="display:none">Nenhum item encontrado.</div>
    </section>

    <!-- RSVP / LOCAL -->
    <section id="rsvp" class="section">
      <div class="grid">
        <div class="card"><div class="body">
          <div class="title">ConfirmaÃ§Ã£o de PresenÃ§a (RSVP)</div>
          <p class="muted">Use o botÃ£o abaixo para confirmar presenÃ§a. Se preferir, fale com a gente por WhatsApp. ðŸ’¬</p>
          <div class="toolbar">
            <a class="btn" id="rsvpBtn" target="_blank" rel="noopener">Abrir formulÃ¡rio</a>
            <a class="btn alt" id="whatsContact" target="_blank" rel="noopener">Falar no Whats</a>
          </div>
        </div></div>
        <div class="card"><div class="body">
          <div class="title">Detalhes do Evento</div>
          <div class="muted" id="dateFull"></div>
          <div class="muted">Local: <strong id="venueFull">â€”</strong></div>
          <div class="muted">EndereÃ§o: <strong id="address"></strong></div>
          <div class="toolbar" style="margin-top:10px">
            <a class="btn alt" id="venueMap2" target="_blank" rel="noopener">Abrir mapa</a>
          </div>
        </div></div>
      </div>
    </section>

    <footer class="muted">Feito com carinho ðŸ’š â€” publique no GitHub Pages (coloque <code>index.html</code>, <code>produtos.xlsx</code> e sua foto <code>hero.jpg</code> na mesma pasta).</footer>
  </main>

  <script>
  // =====================
  // CONFIGURAÃ‡Ã•ES
  // =====================
  const CONFIG = {
    initialsLogo: "K + T",
    coupleNames: "Kelvin & Tamaiale",
    dateNumbers: "27 Â· 08 Â· 2025",
    weddingDateISO: "2025-08-27T19:00:00-03:00",
    venueName: "CartÃ³rio VitÃ³ria",
    venueAddress: "R. Professor MartagÃ£o Gesteira, 477 - GraÃ§a, Salvador",
    mapsLink: "https://www.google.com/maps/place/Cart%C3%B3rio+de+Registro+Civil+das+Pessoas+Naturais+do+Subdistrito+da+Vit%C3%B3ria/@-13.002347,-38.522519,17z",

    // IMAGEM DO TOPO â€” coloque o arquivo junto do index.html (ex.: hero.jpg)
    heroImage: "hero.jpeg",

    // Contato / RSVP / PIX
    whatsappNumber: "71988183846",
    rsvpFormUrl: "https://forms.gle/",
    pixKey: "71988183846",
    pixQrImageUrl: "bradesco.png",

    // Planilha: escolha SÃ“ UMA fonte (xlsx local OU sheetUrl)
    sheetUrl: "",
    localExcelFile: "produtos.xlsx",
    localCsvFile: "",
    moeda: "BRL",
    autoRefreshMinutes: 5
  };

  // utilitÃ¡rios
  const qs = s => document.querySelector(s);
  const el = (tag, attrs={}) => Object.assign(document.createElement(tag), attrs);
  const fmtBRL = v => new Intl.NumberFormat('pt-BR',{style:'currency',currency:CONFIG.moeda}).format((v===undefined||v===null||isNaN(v))?0:Number(v));
  const DEFAULT_IMG = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect fill='%23eee' width='100%' height='100%'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%23999' font-family='sans-serif' font-size='24'>Sem imagem</text></svg>";

  function normHeader(h){return String(h||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,'').trim()}
  function splitCSV(line){const out=[];let cur='';let q=false;for(let i=0;i<line.length;i++){const ch=line[i];if(ch==='"'){q=!q;continue}if(ch===','&&!q){out.push(cur);cur='';continue}cur+=ch}out.push(cur);return out.map(s=>s.trim())}
  function toNumber(x){if(typeof x==='number') return x; if(!x) return 0; const s=String(x).replace(/[^0-9,.-]/g,'').replace(/\.(?=\d{3}(\D|$))/g,'').replace(',', '.'); const n=parseFloat(s); return isNaN(n)?0:n}
  function normalizeItem(o,i){const map={};for(const k in o) map[normHeader(k)]=o[k];return {
    id:String(map.id||i+1), status:String(map.status||'disponivel').toLowerCase().trim(),
    categoria:String(map.categoria||'Outros').trim(), titulo:String(map.titulo||'Item').trim(),
    descricao:String(map.descricao||'').trim(), preco:toNumber(map.preco),
    link:String(map.link||map.loja||'').trim(), imagem:String(map.imagem||map.foto||'').trim(),
    prioridade: parseInt(map.prioridade||(i+1),10) || (i+1)
  }}

  async function fetchSheet(){
    // 1) XLSX local
    if (CONFIG.localExcelFile && CONFIG.localExcelFile.trim()){
      const buf = await fetch(CONFIG.localExcelFile).then(r=>{if(!r.ok) throw new Error('Falha ao carregar '+CONFIG.localExcelFile); return r.arrayBuffer()});
      const wb = XLSX.read(buf, {type:'array'});
      let ws = wb.Sheets[wb.SheetNames[0]];
      for (const n of wb.SheetNames){const rows = XLSX.utils.sheet_to_json(wb.Sheets[n], {header:1, defval:''});if(rows.length>1){ws = wb.Sheets[n];break}}
      const rows = XLSX.utils.sheet_to_json(ws, {header:1, defval:''});
      const headers = (rows.shift()||[]).map(normHeader);
      return rows.filter(r=>r.some(v=>String(v).trim().length>0)).map((cells,i)=>{const o={}; headers.forEach((h,idx)=>o[h]=cells[idx]??''); return normalizeItem(o,i)})
    }
    // 2) CSV local
    if (CONFIG.localCsvFile && CONFIG.localCsvFile.trim()){
      const text = await fetch(CONFIG.localCsvFile).then(r=>{if(!r.ok) throw new Error('Falha ao carregar '+CONFIG.localCsvFile); return r.text()});
      const rows = text.split(/\r?\n/).filter(Boolean).map(splitCSV);
      const headers = (rows.shift()||[]).map(normHeader);
      return rows.map((cells,i)=>{const o={}; headers.forEach((h,idx)=>o[h]=cells[idx]||''); return normalizeItem(o,i)})
    }
    // 3) Google Sheets (opcional)
    if (!CONFIG.sheetUrl) return null;
    const raw = CONFIG.sheetUrl.trim();
    const urls = [/^https?:/.test(raw)? raw : `https://docs.google.com/spreadsheets/d/${raw}/gviz/tq?tqx=out:json`, 'https://r.jina.ai/http://'+raw.replace(/^https?:\/\//,'')];
    for (const url of urls){
      try{
        const text = await fetch(url).then(r=>{if(!r.ok) throw new Error('HTTP '+r.status); return r.text()});
        if(url.includes('tqx=out:json')){
          const start=text.indexOf('{'); const end=text.lastIndexOf('}'); if(start<0||end<0) continue;
          const data = JSON.parse(text.slice(start,end+1));
          const cols=(data.table?.cols||[]).map(c=>normHeader(c.label||c.id||''));
          const rows=(data.table?.rows||[]).map(r=> (r.c||[]).map(c=>c?c.v:''));
          return rows.map((cells,i)=>{const o={}; cols.forEach((h,idx)=>o[h]=cells[idx]||''); return normalizeItem(o,i)})
        }
      }catch(e){console.warn('Falha na planilha', url, e)}
    }
    return null
  }

  // RENDER
  let ITEMS=[];
  function buildCategoryFilter(){const cats=Array.from(new Set(ITEMS.map(i=>i.categoria))).sort(); const sel=qs('#cat'); sel.innerHTML=''; sel.appendChild(el('option',{value:'*',innerText:'Todas as categorias'})); cats.forEach(c=> sel.appendChild(el('option',{value:c, innerText:c}))) }
  function render(){
    const term=qs('#q').value.toLowerCase().trim(); const cat=qs('#cat').value; const only=qs('#onlyAvail').checked; const sort=qs('#sort').value;
    let arr=[...ITEMS];
    if(term) arr = arr.filter(i=> (i.titulo+" "+i.descricao+" "+i.categoria).toLowerCase().includes(term));
    if(cat && cat!=="*") arr = arr.filter(i=> i.categoria===cat);
    if(only) arr = arr.filter(i=> i.status==='disponivel');
    if(sort==='preco-asc') arr.sort((a,b)=>a.preco-b.preco);
    else if(sort==='preco-desc') arr.sort((a,b)=>b.preco-a.preco);
    else if(sort==='titulo') arr.sort((a,b)=> a.titulo.localeCompare(b.titulo));
    else arr.sort((a,b)=> a.prioridade-b.prioridade);

    const wrap=qs('#products'); wrap.innerHTML='';
    if(arr.length===0){qs('#emptyState').style.display='block'; return} else qs('#emptyState').style.display='none';
    for(const it of arr){
      const card = el('div',{className:'product'});
      const img = el('div',{className:'img'});
      const picture = new Image(); picture.loading='lazy'; picture.referrerPolicy='no-referrer'; picture.src = (it.imagem&&it.imagem.trim())? it.imagem : DEFAULT_IMG; picture.onerror = ()=>{picture.src=DEFAULT_IMG};
      img.appendChild(picture);
      const content = el('div',{className:'content'});
      const title = el('div',{style:'font-weight:600; font-size:18px', innerText: it.titulo});
      const desc = el('div',{className:'muted', innerText: it.descricao});
      const price= el('div',{className:'price', innerText: it.preco? fmtBRL(it.preco): 'â€”'});
      let host=''; try{ if(it.link) host = new URL(it.link, location.href).hostname.replace(/^www\./,''); }catch{}
      const tiny = el('div',{className:'tiny', innerText: host});
      const actions = el('div',{className:'actions'});
      const btnReserve = el('a',{className:'btn', target:'_blank', rel:'noopener', innerText:'Reservar (WhatsApp)'});
      btnReserve.href = `https://wa.me/${CONFIG.whatsappNumber}?text=${encodeURIComponent(`Oi! Quero presentear com: ${it.titulo} (${it.categoria})${it.preco? ' â€” '+fmtBRL(it.preco): ''}. Link: ${it.link||'-'}`)}`;
      const btnBuy = el('a',{className:'btn alt', target:'_blank', rel:'noopener', innerText:'Comprar na loja'});
      btnBuy.href = it.link || '#';
      const btnCopy = el('button',{className:'btn ghost', innerText:'Copiar nome'});
      btnCopy.onclick = ()=>{navigator.clipboard.writeText(it.titulo).then(()=>{btnCopy.innerText='Copiado!'; setTimeout(()=>btnCopy.innerText='Copiar nome',1200)})};
      actions.append(btnReserve, btnBuy, btnCopy);
      content.append(title, desc, price, tiny, actions);
      card.append(img, content);
      wrap.appendChild(card);
    }
  }

  // INIT
  async function init(){
    // Preenche info textual
    document.title = `${CONFIG.coupleNames} â€” ${CONFIG.dateNumbers}`;
    qs('.brand').firstChild && (qs('.brand').firstChild.textContent = CONFIG.initialsLogo);
    qs('.hero-date').textContent = CONFIG.dateNumbers;
    qs('.hero-names').textContent = CONFIG.coupleNames;
    qs('#dateFull').textContent = new Date(CONFIG.weddingDateISO).toLocaleString('pt-BR',{weekday:'long', day:'2-digit', month:'long', year:'numeric', hour:'2-digit', minute:'2-digit'});
    qs('#venueFull').textContent = CONFIG.venueName;
    qs('#address').textContent = CONFIG.venueAddress;
    qs('#venueMap2').href = CONFIG.mapsLink;

    // PIX
    qs('#pixKeyText').textContent = CONFIG.pixKey || 'â€”';
    qs('#openPixWhats').href = `https://wa.me/${CONFIG.whatsappNumber}?text=${encodeURIComponent('Enviei um presente via Pix. Segue o comprovante:')}`;
    if(CONFIG.pixQrImageUrl){ qs('#pixQrImg').src = CONFIG.pixQrImageUrl; }

    // RSVP e contato
    if(CONFIG.rsvpFormUrl) qs('#rsvpBtn').href = CONFIG.rsvpFormUrl; else qs('#rsvpBtn').style.display='none';
    qs('#whatsContact').href = `https://wa.me/${CONFIG.whatsappNumber}?text=${encodeURIComponent('OlÃ¡! Gostaria de falar sobre o casamento.')}`;

    // BotÃµes
    qs('#copyPix').onclick = ()=>{ navigator.clipboard.writeText(CONFIG.pixKey||'').then(()=>{ const b=qs('#copyPix'); const t=b.textContent; b.textContent='Copiado!'; setTimeout(()=>b.textContent=t, 1200) }) };

    // Foto do topo
    const heroEl = document.getElementById('heroImageEl'); heroEl.setAttribute('href', CONFIG.heroImage);

    // Dados
    let data = null; try{ data = await fetchSheet(); }catch(e){ console.warn('fetchSheet err', e)}
    if(!Array.isArray(data) || data.length===0){ console.warn('Planilha vazia/erro.'); data = [] }
    ITEMS = data; buildCategoryFilter(); render();

    // Filtros
    ['q','cat','sort','onlyAvail'].forEach(id=> qs('#'+id).addEventListener(id==='q'?'input':'change', render));
    qs('#refresh').onclick = async()=>{ const d = await fetchSheet(); if(Array.isArray(d)){ ITEMS=d; buildCategoryFilter(); render(); }}
    if(CONFIG.autoRefreshMinutes>0){ setInterval(async()=>{ const d = await fetchSheet(); if(Array.isArray(d)){ ITEMS=d; buildCategoryFilter(); render(); } }, CONFIG.autoRefreshMinutes*60000)}
  }
  window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
